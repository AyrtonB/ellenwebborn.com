Regression discontinuity designs (RDDs) are now a widely used tool for program evaluation in economics and many other fields. RDDs occur in situations where some treatment/program of interest is assigned on the basis of a numerical score (called the running variable), where treatment is assigned to all units scoring above a certain threshold are withheld from all units scoring at or below the threshold (or vice versa, with treatment assigned to units scoring below the threshold). This mechanism provides a way to identify the __marginal average treatment effect__, that is the effect of treatment assignment for units on the cusp of eligibility for treatment. 

RDDs are appealing for several reasons. First and foremost, the RDD mechanism occurs all over the place---providing treatment on the basis of a numerical measure of need/eligibility is a natural way to allocate resources. Furthermore, analysis of the designs is straight-forward, as it involves nothing more complicated than a linear regression model, estimated using (weighted or un-weighted) least squares, which can be represented graphically using a simple scatterplot. 

I'll describe the most basic analysis of a "sharp" RDD, in which all units comply with treatment assignment (or where we adopt the intent-to-treat approach and model the effect of treatment assignment, regardless of treatment compliance status). Let $Y$ be the outcome of interest; $R$ be the running variable, assumed to be centered at the threshold; and $T$ be an indicator for treatment assignment, with $T = I(R > 0)$. Given a random sample $\left(Y_i,R_i,T_i\right)_{i=1}^n$, the marginal average treatment effect is typically estimated using a local linear regression. Here, one chooses weights for each unit based on a measure of distance from the threshold. Common choices are to weight based on a triangular edge kernel, where 
$$w_i = I\left(|R_i| < b\right) \times \frac{2\left|b - R_i\right|}{b^2}$$

for some bandwidth $b$, or to use a "rectangular" kernel with $w_i = I\left(|R_i| < b\right)$, again for some bandwidth $b$. Using a rectangular kernel amounts to limiting the analysis to the subset of observations with $|R_i < b|$. (There are several proposals for how best to choose a bandwidth, but in practice one also conducts sensitivity analyses to examine whether the choice matters.) Given weights, one then estimates the linear regression

$$Y_i = \beta_0 + \beta_1 R_i + \beta_2 T_i + \beta_3 R_i T_i + \epsilon_i$$

by weighted least squares. The coefficient $\beta_2$ represents the marginal average treatment effect. 

### Including covariates

In practice, it is common to estimate models that include additional covariates besides just the running variable, treatment indicator, and their interaction. The simplest way to do so is to introduce the covariates as additional terms in the regression, i.e., 

$$Y_i = \beta_0 + \beta_1 R_i + \beta_2 T_i + \beta_3 R_i T_i + \beta_4 X_i + \epsilon_i,$$

where $X_i$ is a generic covariate (which may be a matrix with several components). However, introducing the covariate means that the models for the treated and untreated observations are no longer entirely independent, which might concern some analysts. How, then, should one estimate the marginal average treatment effect while allowing for interaction between $T$ and $X$?

### The `rdd` package

The [`rdd` package](https://cran.r-project.org/web/packages/rdd/) provides a set of methods for analysis of RDDs, including methods to estimate marginal average treatment effects in models with covariates. I was working with the package recently and noticed that the 


### The marginalization esitmator 